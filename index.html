<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1 mes contigo ‚ú®</title>

  <style>
    :root{
      --bg:#0b0b10; --card:#12121a; --txt:#f2f2f7; --muted:#b6b6c6;
      --accent:#ff5da2; --accent2:#7c5cff; --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1000px 600px at 20% 10%, rgba(255,93,162,.18), transparent 60%),
                  radial-gradient(900px 500px at 80% 30%, rgba(124,92,255,.18), transparent 60%),
                  var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:980px; margin:0 auto; padding:28px 16px 60px}
    .hero{
      padding:26px; border-radius:var(--radius);
      background: linear-gradient(135deg, rgba(255,93,162,.16), rgba(124,92,255,.12));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .badge{display:inline-flex; gap:8px; align-items:center; padding:8px 12px;
      border-radius:999px; background:rgba(255,255,255,.07); color:var(--muted); font-size:14px}
    h1{margin:14px 0 8px; font-size:38px; line-height:1.1}
    h2{margin:0 0 8px}
    p{margin:8px 0; color:var(--muted); font-size:16px; line-height:1.6}
    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; margin-top:16px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} h1{font-size:32px}}
    .card{
      background:rgba(18,18,26,.86); border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius); padding:18px;
    }
    .btn{
      cursor:pointer; border:none; color:var(--txt);
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      padding:12px 14px; border-radius:14px; font-weight:650; width:100%;
      transition: transform .08s ease, opacity .15s ease;
    }
    .btn:active{transform: scale(.99)}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .pill{padding:8px 10px; border-radius:999px; background:rgba(255,255,255,.07); color:var(--muted); font-size:13px}
    input{
      width:100%; border-radius:14px; padding:12px 12px; margin-top:10px;
      border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05); color:var(--txt);
      outline:none;
    }
    .small{font-size:13px; color:rgba(255,255,255,.55)}
    .divider{height:1px; background:rgba(255,255,255,.08); margin:16px 0}

    .daygrid{display:grid; grid-template-columns: repeat(5, 1fr); gap:10px}
    @media (max-width: 700px){ .daygrid{grid-template-columns: repeat(3,1fr)} }
    .day{
      background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08);
      border-radius:14px; padding:10px; min-height:92px;
      display:flex; flex-direction:column; justify-content:space-between; gap:8px;
    }
    .day strong{font-size:13px; color:rgba(255,255,255,.78)}
    .day .meta{font-size:12px; color:rgba(255,255,255,.55)}
    .day button{
      border:none; border-radius:12px; padding:8px 10px; cursor:pointer;
      background:rgba(255,255,255,.08); color:rgba(255,255,255,.9); font-weight:600;
    }
    .day.locked{opacity:.55}
    .day.locked button{cursor:not-allowed}

    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:none; align-items:center; justify-content:center; padding:16px;
    }
    .modal .box{
      max-width:560px; width:100%; border-radius:18px; padding:18px;
      background:rgba(18,18,26,.95); border:1px solid rgba(255,255,255,.10);
    }
    .close{float:right; cursor:pointer; color:rgba(255,255,255,.65)}
    .actions{display:flex; gap:10px; flex-wrap:wrap}

    /* ===== Tulipanes ===== */
    .tulip-wrap{display:flex; flex-direction:column; gap:12px}
    .tulip-canvas{
      width:100%;
      height:420px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      touch-action:none;
    }

    /* ===== Citas: ‚Äúpantallita‚Äù vertical autom√°tica ===== */
    .dates-viewport{
      position:relative;
      height: 360px;
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
    }
    .dates-viewport::before,
    .dates-viewport::after{
      content:"";
      position:absolute; left:0; right:0;
      height:38px; pointer-events:none;
      z-index:2;
    }
    .dates-viewport::before{
      top:0;
      background: linear-gradient(to bottom, rgba(18,18,26,.95), rgba(18,18,26,0));
    }
    .dates-viewport::after{
      bottom:0;
      background: linear-gradient(to top, rgba(18,18,26,.95), rgba(18,18,26,0));
    }

    .dates-list{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:12px;
      will-change: transform;
    }

    .date-card{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px 12px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease;
      user-select:none;
    }
    .date-card:hover{ transform: translateY(-1px); background:rgba(255,255,255,.06); }

    .date-top{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .date-title{font-weight:750; color:rgba(255,255,255,.88); font-size:14px}
    .date-badge{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(255,93,162,.18);
      border:1px solid rgba(255,93,162,.25);
      color:rgba(255,255,255,.80);
      white-space:nowrap;
    }
    .date-meta{margin-top:6px; font-size:13px; color:rgba(255,255,255,.65); line-height:1.35}
    .date-icons{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap}
    .date-pill{
      font-size:12px; color:rgba(255,255,255,.68);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      padding:6px 10px; border-radius:999px;
      user-select:none;
    }

    .date-img{
      width:100%;
      height:140px;
      border-radius:14px;
      margin-top:10px;
      object-fit:cover;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.04);
      filter:saturate(1.08) contrast(1.05);
    }

    .paused-hint{
      font-size:12px; color:rgba(255,255,255,.45);
      margin-top:8px;
    }

    /* ===== REELS ===== */
    .reels-grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 700px){
      .reels-grid{ grid-template-columns: 1fr; }
    }
    .reel-card{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.05);
      overflow:hidden;
      transition: transform .08s ease, background .15s ease;
    }
    .reel-card:hover{ transform: translateY(-1px); background:rgba(255,255,255,.06); }
    .reel-thumb{
      width:100%;
      height:160px;
      object-fit:cover;
      display:block;
      background:rgba(255,255,255,.04);
    }
    .reel-body{ padding:10px 12px 12px; }
    .reel-title{
      margin:0 0 6px;
      font-weight:750;
      color:rgba(255,255,255,.88);
      font-size:14px;
    }
    .reel-note{
      margin:0;
      font-size:13px;
      color:rgba(255,255,255,.65);
      line-height:1.35;
    }
    .reel-link{
      text-decoration:none;
      color:inherit;
      display:block;
    }

    /* ===== Spotify embed ===== */
    .spotify-embed{
      width:100%;
      height:152px;
      border:0;
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,.04);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="lockGate" class="card" style="display:none; margin-bottom:14px">
      <h2 style="margin:0 0 8px">A√∫n no se desbloquea üîí</h2>
      <p class="small" id="lockText" style="margin:0"></p>
    </div>

    <section class="hero">
      <div class="badge">üíå Regalo online ¬∑ <span id="today"></span></div>

      <h1>Un mes contigo, <span style="color:var(--accent)" id="herName">mi amor</span>.</h1>

      <p>
        <strong id="myName">[TU NOMBRE]</strong> √ó <strong id="yourName">[SU NOMBRE]</strong><br/>
        Aunque estemos lejos, aqu√≠ tienes un pedacito de m√≠.
      </p>

      <div class="row" style="margin-top:10px">
        <span class="pill">‚ú® 1 mes</span>
        <span class="pill">üìç <span id="cities">[CIUDAD] ‚Üî [CIUDAD]</span></span>
        <span class="pill">üóìÔ∏è Inicio: <span id="startLabel">[FECHA]</span></span>
        <span class="pill">‚è≥ D√≠a actual: <span id="rawDay">0</span></span>
      </div>

      <div class="grid">
        <!-- Izquierda -->
        <div class="card">
          <h2>Carta</h2>
          <p id="letter">
            Estamos cerca de cumplir 1 mes ya como algo m√°s que amigos y quer√≠a darte un peque√±o detalle, aunque estemos a distancia. Por eso hice esta p√°gina: cada d√≠a habr√° un mensaje para ti y una canci√≥n nueva que espero te guste.
Ya te lo he dicho muchas veces, pero te lo vuelvo a decir: me gustas por c√≥mo eres, por c√≥mo te expresas y por c√≥mo piensas. Me emociona seguir creando recuerdos contigo y poder compartir m√°s momentos a tu lado.
Mientras llega el d√≠a de verte, que esta p√°gina sea como un puente: un pedacito de m√≠ contigo todos los d√≠as. Y recuerda: si necesitas hablar, aqu√≠ voy a estar.<br/>
            <span style="color:rgba(255, 255, 255, 0.842)">Por mas tiempo creando bonitos recuerdos .</span>
          </p>

          <div class="divider"></div>

          <!-- ‚úÖ Reels -->
          <h3 style="margin:0 0 8px">Reels que me recuerdan a ti ‚ú®</h3>
          <div id="reelsGrid" class="reels-grid"></div>

          <span id="plan" style="display:none;"></span>
        </div>

        <!-- Derecha -->
        <div class="card">
          <h2>Nuestras citas ‚ú®</h2>
          <p class="small">

          <div class="dates-viewport" id="datesViewport">
            <div id="datesList" class="dates-list"></div>
          </div>

          <div class="paused-hint"></div>

          <!-- ‚úÖ Playlist de Spotify (embed + bot√≥n) -->
          <div class="divider"></div>
          <h3 style="margin:0 0 8px">Playlist en Spotify üíö</h3>
          <p class="small" style="margin-top:0">Para cuando quieras escuchar nuestras canciones en Spotify.</p>

          <iframe id="spotifyEmbed" class="spotify-embed" style="display:none;"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy"></iframe>

          <div class="actions" style="margin-top:10px">
            <a id="spotifyOpen" class="btn" href="#"
               target="_blank" rel="noopener noreferrer"
               style="max-width:220px; text-decoration:none; display:inline-block; text-align:center;">
              Abrir playlist üéß
            </a>
          </div>

          <p class="small" id="spotifyHint" style="margin-top:10px; opacity:.85"></p>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:14px">
      <h2>D√≠as 17 ‚Üí 30</h2>
      <p class="small">Esta parte solo existe desde el d√≠a 157 en adelante.</p>
      <div class="daygrid" id="days"></div>
    </section>

    <section class="card" style="margin-top:14px">
      <h2 style="margin:0 0 8px">Dibuja tulipanes üå∑</h2>
      <p class="small" style="margin-top:0">
        Haz click (o toca en el cel) para plantar un tulip√°n. Cada uno sale un poquito distinto.<br/>
        No puedo dartelas en persona esta vez, pero aqui estan estas flores en lo que nos vemos.
      </p>

      <div class="tulip-wrap">
        <canvas id="tulipCanvas" class="tulip-canvas"></canvas>
        <div class="actions">
          <button class="btn" style="max-width:220px" id="tulipClear">Limpiar</button>
          <button class="btn" style="max-width:220px" id="tulipSave">Guardar PNG</button>
        </div>
      </div>
    </section>

    <div class="footer" style="margin-top:18px; text-align:center; color:rgba(255,255,255,.45); font-size:13px">
      Hecho con cari√±o y un poquito de magia nerd ‚ú®
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="box">
      <span class="close" onclick="closeModal()">‚úï</span>
      <h3 id="modalTitle" style="margin:0 0 8px"></h3>
      <p id="modalBody" style="margin:0; color:var(--muted)"></p>
    </div>
  </div>

  <script>
    // =========================
    // 1) PERSONALIZA AQU√ç üëá
    // =========================
    const CONFIG = {
      myName: "Eduardo",
      herName: "Ximena",
      cities: "Monterrey ‚Üî Matehuala",
      startDate: "2025-11-28",
      unlockFromDay: 17,
      secretCode: "x",
      plan: "cena + caminar + muchas fotos",
      totalDays: 30,
      spotifyPlaylistUrl: "https://open.spotify.com/playlist/1fitpxZ8XcjZIXAjIGuFPA?si=Ri-9lx-eT5Cbl8VJoru0ng"
    };

    const messages = Array.from({length: CONFIG.totalDays}, (_, i) => `D√≠a ${i+1}: escribe aqu√≠ algo bonito üíñ`);
    messages[16] = "D√≠a 17: Hoy empieza este mini ritual: un mensaje y una canci√≥n, solo para ti. Gracias por estar aqu√≠. üå∑";
    messages[17] = "D√≠a 18: Me gustas en lo simple: c√≥mo piensas, c√≥mo sientes y c√≥mo eres, y eso te hace unica";
    messages[18] = "D√≠a 19: Si hoy fue un d√≠a pesado, recuerda esto: no tienes que sentirte sola. Aqu√≠ estoy.";
    messages[19] = "D√≠a 20: Si hoy te falt√≥ motivaci√≥n, te presto la m√≠a. T√∫ solo respira, yo te acompa√±o desde ac√°";
    messages[20] = "D√≠a 21: Eres mi pensamiento favorito cuando el d√≠a se pone raro.";
    messages[21] = "D√≠a 22: Me encanta conocerte en detalles: tus gustos, tus man√≠as, lo que te emociona y lo que no toleras.";
    messages[22] = "D√≠a 23: Eres de esas personas que hacen que el mundo se sienta m√°s suave. Gracias por existir as√≠";
    messages[23] = "D√≠a 24: Ojal√° hoy te pase algo bonito, aunque sea chiquito";
    messages[24] = "D√≠a 25: Estoy orgulloso de ti, incluso por cosas que nadie ve";
    messages[25] = "D√≠a 26: Gracias por dejarme acercarme a ti. Me hace feliz conocerte poco a poco.";
    messages[26] = "D√≠a 27: Eres mi tipo de persona: aut√©ntica, inteligente y con coraz√≥n";
    messages[27] = "D√≠a 28: Hoy te recuerdo algo simple: me importas y mucho";
    messages[28] = "D√≠a 29: Eres de esas personas que hacen el mundo m√°s bonito sin intentarlo.";
    messages[29] = "D√≠a 30: Hoy cumplimos un mes, y solo quiero decirte esto: me haces sentir muy bien, y me encanta que seas t√∫";

    const msPerDay = 24*60*60*1000;
    const stripTime = (d) => new Date(d.getFullYear(), d.getMonth(), d.getDate());

    function showModal(title, body){
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("modalBody").textContent = body;
      document.getElementById("modal").style.display = "flex";
    }
    function closeModal(){ document.getElementById("modal").style.display = "none"; }

    // =========================
    // REELS ‚úÖ
    // =========================
    const reels = [
      { title:"Reel 1 ‚ú®", note:"", url:"https://www.instagram.com/reel/DFS8hQHOTUP/?igsh=MXFlMmRuNHRjNmczaA==", img:"reels/reel1.jpg" },
      { title:"Reel 2 ü´∂", note:"", url:"https://www.instagram.com/reel/DQuIFH5EfIY/?igsh=MWRsZnU1bGRscTl2eA==", img:"reels/reel2.jpg" },
      { title:"Reel 3 üåô", note:"", url:"https://www.instagram.com/p/DRcaJHMjSp4/?igsh=MTZtYnJqMGZpc2Q0", img:"reels/reel3.jpg" },
      { title:"Reel 4 üå∑", note:"", url:"https://www.instagram.com/reel/DRlLbXLjgYv/?igsh=NTdocjZsOTZzajVp", img:"reels/reel4.jpg" }
    ];

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function reelPlaceholderSVG(label){
      return `
        <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="rgba(255,93,162,0.28)"/>
              <stop offset="1" stop-color="rgba(124,92,255,0.22)"/>
            </linearGradient>
          </defs>
          <rect width="1200" height="700" fill="rgba(255,255,255,0.04)"/>
          <rect width="1200" height="700" fill="url(#g)"/>
          <text x="60" y="120" fill="rgba(255,255,255,0.92)" font-family="system-ui, -apple-system, Segoe UI, Roboto" font-size="62" font-weight="800">
            ${label}
          </text>
          <text x="60" y="200" fill="rgba(255,255,255,0.70)" font-family="system-ui, -apple-system, Segoe UI, Roboto" font-size="34">
            Reels para ti
          </text>
        </svg>
      `;
    }

    function renderReels(){
      const grid = document.getElementById("reelsGrid");
      if(!grid) return;

      grid.innerHTML = reels.map(r => {
        const imgSrc = r.img
          ? r.img
          : `data:image/svg+xml,${encodeURIComponent(reelPlaceholderSVG(r.title))}`;

        return `
          <div class="reel-card">
            <a class="reel-link" href="${r.url}" target="_blank" rel="noopener noreferrer">
              <img class="reel-thumb" src="${imgSrc}" alt="${escapeHtml(r.title)}" loading="lazy">
              <div class="reel-body">
                <div class="reel-title">${escapeHtml(r.title)}</div>
                <p class="reel-note">${escapeHtml(r.note)}</p>
              </div>
            </a>
          </div>
        `;
      }).join("");
    }

    // =========================
    // Citas con im√°genes ‚úÖ
    // =========================
    const dates = [
      { n:1, title:"Yamato + Museo La Milarca", meta:"Comida rica + cultura (plan perfecto).",
        pills:["üç± Yamato","üèõÔ∏è La Milarca","‚ú® Primera cita"],
        body:"Primera cita: Yamato + La Milarca. Un plan con vibra bonita: comer rico y luego pasear/mirar cosas incre√≠bles juntos.",
        img:"img/cita1.jpg" },

      { n:2, title:"Princesa Mononoke + Matcha Garden", meta:"Anime + matcha = peligro de enamoramiento.",
        pills:["üé¨ Mononoke","üçµ Matcha Garden","üåø Vibes"],
        body:"Vimos La Princesa Mononoke y luego fuimos a Matcha Garden. El combo perfecto para una tarde que se queda guardada.",
        img:"img/cita2.jpg" },

      { n:3, title:"Hielo + 31 Minutos + Carl‚Äôs Jr.", meta:"Ca√≠das con estilo + museo + hamburguesa final.",
        pills:["‚õ∏Ô∏è Hielo","üß∏ 31 Minutos","üçî Carl‚Äôs Jr."],
        body:"Patinar en hielo, el museo de 31 Minutos y terminar en Carl‚Äôs Jr. Cita ca√≥tica y feliz (las mejores).",
        img:"img/cita3.jpg" },

      { n:4, title:"Bolos + Pizza", meta:"Competencia sana (seg√∫n) + pizza (seguro).",
        pills:["üé≥ Bolos","üçï Pizza","üòÑ Risas"],
        body:"Fuimos a los bolos y luego pizza. Plan cl√°sico que no falla, y contigo menos.",
        img:"img/cita4.jpg" },

      { n:5, title:"Picnic + LEGO del robotcito", meta:"Cielo, snack y construir algo juntos.",
        pills:["üß∫ Picnic","üß± LEGO","ü§ñ Robotcito"],
        body:"Salimos de picnic y armamos el LEGO del robotcito. De esas tardes que se sienten como hogar.",
        img:"img/cita5.jpg" },

      { n:6, title:"Feria del Libro de Monterrey", meta:"Libros, caminar y encontrarnos en pasillos.",
        pills:["üìö Feria del libro","‚ú® Plan tranqui"],
        body:"Fuimos a la Feria del Libro de Monterrey. Paseo largo, pl√°tica rica, y el sentimiento de 'me gusta estar aqu√≠ contigo'.",
        img:"img/cita6.jpg" },

      { n:7, title:"Incredible Pizza (aqu√≠ nos hicimos novios)", meta:"El d√≠a que pas√≥ lo importante üíò",
        pills:["üçï Incredible Pizza","üíò Novios","üéÆ Diversi√≥n"],
        body:"Fuimos a Incredible Pizza‚Ä¶ y aqu√≠ nos hicimos novios. Fin del comunicado oficial: te eleg√≠. üíñ",
        badge:"üíò Nos hicimos novios",
        img:"img/cita7.jpg" }
    ];

    function dateCardHTML(d){
      return `
        <div class="date-card" data-n="${d.n}">
          <div class="date-top">
            <div class="date-title">Cita ${d.n}: ${d.title}</div>
            ${d.badge ? `<div class="date-badge">${d.badge}</div>` : `<div class="date-badge">‚ú® Cita ${d.n}</div>`}
          </div>

          <div class="date-meta">${d.meta}</div>

          ${d.img ? `<img class="date-img" src="${d.img}" alt="Foto de la cita ${d.n}" loading="lazy">` : ""}

          <div class="date-icons">
            ${d.pills.map(p => `<span class="date-pill">${p}</span>`).join("")}
          </div>
        </div>
      `;
    }

    function renderDatesLoop(){
      const list = document.getElementById("datesList");
      if(!list) return;

      list.innerHTML = dates.map(dateCardHTML).join("") + dates.map(dateCardHTML).join("");

      list.querySelectorAll(".date-card").forEach(card => {
        card.addEventListener("click", () => {
          const n = Number(card.getAttribute("data-n"));
          const d = dates.find(x => x.n === n);
          if(d) showModal(`Cita ${d.n} ‚ú®`, d.body);
        });
      });
    }

    // =========================
    // L√≥gica de d√≠as + gate
    // =========================
    const start = new Date(CONFIG.startDate + "T00:00:00");
    const today = new Date();

    document.getElementById("today").textContent = today.toLocaleDateString("es-MX", {
      weekday:"long", year:"numeric", month:"long", day:"numeric"
    });

    document.getElementById("myName").textContent = CONFIG.myName;
    document.getElementById("yourName").textContent = CONFIG.herName;
    document.getElementById("herName").textContent = CONFIG.herName;
    document.getElementById("cities").textContent = CONFIG.cities;
    document.getElementById("startLabel").textContent = CONFIG.startDate;

    const planEl = document.getElementById("plan");
    if (planEl) planEl.textContent = CONFIG.plan;

    const rawDayIndex = Math.floor((stripTime(today) - stripTime(start)) / msPerDay) + 1;
    document.getElementById("rawDay").textContent = Math.max(rawDayIndex, 0);

    const unlockFromDay = CONFIG.unlockFromDay || 1;
    const totalDays = CONFIG.totalDays || 30;
    const gateUnlocked = rawDayIndex >= unlockFromDay;

    const lockGate = document.getElementById("lockGate");
    const lockText = document.getElementById("lockText");

    if (!gateUnlocked) {
      const unlockDate = new Date(start.getTime() + (unlockFromDay - 1)*msPerDay);
      const daysLeft = Math.ceil((stripTime(unlockDate) - stripTime(today)) / msPerDay);
      lockGate.style.display = "block";
      lockText.textContent = `Se desbloquea el ${unlockDate.toLocaleDateString("es-MX")} (faltan ${daysLeft} d√≠a(s)).`;
    } else {
      lockGate.style.display = "none";
    }

    // =========================
    // D√≠as 15..30
    // =========================
    const daysEl = document.getElementById("days");
    daysEl.innerHTML = "";

    for (let realDay = unlockFromDay; realDay <= totalDays; realDay++) {
      const unlockDate = new Date(start.getTime() + (realDay - 1)*msPerDay);
      const isUnlocked = stripTime(today) >= stripTime(unlockDate);

      const div = document.createElement("div");
      div.className = "day" + (isUnlocked ? "" : " locked");
      div.innerHTML = `
        <strong>D√≠a ${realDay}</strong>
        <div class="meta">${unlockDate.toLocaleDateString("es-MX")}</div>
        <button ${isUnlocked ? "" : "disabled"} onclick="showDay(${realDay})">
          ${isUnlocked ? "Abrir" : "Bloqueado"}
        </button>
      `;
      daysEl.appendChild(div);
    }

    function showDay(realDay){
      const idx = realDay - 1;
      showModal(`D√≠a ${realDay} üíå`, messages[idx] || "Escribe tu mensaje aqu√≠.");
    }

    // =========================
    // Spotify embed + bot√≥n ‚úÖ
    // =========================
    function toSpotifyEmbedUrl(url){
      if(!url) return "";
      let u = String(url).trim();
      u = u.split("?")[0];

      if (u.includes("open.spotify.com/embed/")) return u;

      if (u.includes("open.spotify.com/playlist/")) {
        return u.replace("open.spotify.com/", "open.spotify.com/embed/");
      }

      if (u.includes("open.spotify.com/track/")) {
        return u.replace("open.spotify.com/", "open.spotify.com/embed/");
      }

      if (u.startsWith("spotify:playlist:")) {
        const id = u.split(":").pop();
        return `https://open.spotify.com/embed/playlist/${id}`;
      }

      return "";
    }

    (()=> {
      const embed = document.getElementById("spotifyEmbed");
      const open = document.getElementById("spotifyOpen");
      const hint = document.getElementById("spotifyHint");
      if(!embed || !open || !hint) return;

      const url = (CONFIG.spotifyPlaylistUrl || "").trim();
      const embedUrl = toSpotifyEmbedUrl(url);

      if(!url || !embedUrl){
        embed.style.display = "none";
        open.style.display = "none";
        hint.textContent = "Pega tu link real de playlist en CONFIG.spotifyPlaylistUrl (de open.spotify.com).";
        return;
      }

      if(!gateUnlocked){
        embed.style.display = "none";
        open.style.opacity = "0.55";
        open.style.pointerEvents = "none";
        open.href = url;
        hint.textContent = `Playlist bloqueada hasta el d√≠a ${unlockFromDay}.`;
        return;
      }

      embed.src = embedUrl;
      embed.style.display = "block";
      open.href = url;
      open.style.opacity = "1";
      open.style.pointerEvents = "auto";
      hint.textContent = "";
    })();

    // =========================
    // Auto-scroll vertical infinito (3 visibles)
    // =========================
    function startAutoVerticalScroll(){
      const viewport = document.getElementById("datesViewport");
      const list = document.getElementById("datesList");
      if(!viewport || !list) return;

      let paused = false;
      viewport.addEventListener("mouseenter", () => paused = true);
      viewport.addEventListener("mouseleave", () => paused = false);
      viewport.addEventListener("touchstart", () => paused = true, {passive:true});
      viewport.addEventListener("touchend", () => paused = false, {passive:true});

      requestAnimationFrame(() => {
        const firstSetHeight = list.scrollHeight / 2;
        let y = 0;
        const speedPxPerFrame = 0.6;

        function tick(){
          if(!paused){
            y += speedPxPerFrame;
            if (y >= firstSetHeight) y -= firstSetHeight;
            viewport.scrollTop = y;
          }
          requestAnimationFrame(tick);
        }
        viewport.scrollTop = 0;
        tick();
      });
    }

    // Arranque
    renderDatesLoop();
    startAutoVerticalScroll();
    renderReels();

    // =========================
    // Tulipanes (igual que antes)
    // =========================
    (() => {
      const canvas = document.getElementById("tulipCanvas");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");
      const clearBtn = document.getElementById("tulipClear");
      const saveBtn  = document.getElementById("tulipSave");

      function rand(a,b){ return a + Math.random()*(b-a); }
      function hsl(h, s, l, a=1){ return `hsla(${h} ${s}% ${l}% / ${a})`; }
      function clamp2(x,a,b){ return Math.max(a, Math.min(b,x)); }

      function resizeCanvas(){
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width  = Math.floor(rect.width * dpr);
        canvas.height = Math.floor(rect.height * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        drawBackground();
      }

      function drawBackground(){
        const w = canvas.getBoundingClientRect().width;
        const h = canvas.getBoundingClientRect().height;

        ctx.clearRect(0,0,w,h);

        ctx.fillStyle = "rgba(255,255,255,0.03)";
        ctx.fillRect(0, h*0.72, w, h*0.28);

        for(let i=0;i<18;i++){
          const x = Math.random()*w;
          const y = Math.random()*h;
          const r = 1 + Math.random()*2.5;
          ctx.beginPath();
          ctx.fillStyle = "rgba(255,255,255,0.08)";
          ctx.arc(x,y,r,0,Math.PI*2);
          ctx.fill();
        }
      }

      function drawLeaf(ctx, x, y, len, w, angleRad, colorFill, colorStroke){
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angleRad);

        ctx.fillStyle = colorFill;
        ctx.strokeStyle = colorStroke;
        ctx.lineWidth = 1.2;

        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(w*0.9, -len*0.25, 0, -len);
        ctx.quadraticCurveTo(-w*0.9, -len*0.25, 0, 0);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(0, -len*0.45, 0, -len);
        ctx.stroke();

        ctx.restore();
      }

      function drawTulipBloom(ctx, cx, cy, w, h, hue){
        const back = hsl(hue, 85, 52, 0.95);
        const mid  = hsl(hue, 90, 58, 0.95);
        const front= hsl(hue, 95, 64, 0.95);

        ctx.fillStyle = "rgba(0,0,0,0.18)";
        ctx.beginPath();
        ctx.ellipse(cx+3, cy+8, w*0.95, h*0.65, 0, 0, Math.PI*2);
        ctx.fill();

        function petal(offsetX, tipLift, color, zStroke){
          const baseY = cy + h*0.40;
          const tipX  = cx + offsetX;
          const tipY  = cy - h*0.55 - tipLift;

          const leftX = cx + offsetX - w*0.55;
          const rightX= cx + offsetX + w*0.55;

          const grad = ctx.createLinearGradient(cx, cy-h, cx, cy+h);
          grad.addColorStop(0, hsl(hue, 95, 72, 0.95));
          grad.addColorStop(1, color);

          ctx.fillStyle = grad;
          ctx.strokeStyle = zStroke;
          ctx.lineWidth = 1;

          ctx.beginPath();
          ctx.moveTo(cx + offsetX, baseY);
          ctx.bezierCurveTo(leftX, cy + h*0.15, leftX*0.98, cy - h*0.35, tipX, tipY);
          ctx.bezierCurveTo(rightX*1.02, cy - h*0.35, rightX, cy + h*0.15, cx + offsetX, baseY);
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
        }

        petal(-w*0.30, rand(0,6), back, "rgba(255,255,255,0.10)");
        petal( w*0.30, rand(0,6), back, "rgba(255,255,255,0.10)");
        petal(0, rand(2,10), mid, "rgba(255,255,255,0.14)");
        petal(-w*0.14, rand(4,12), front, "rgba(255,255,255,0.18)");
        petal( w*0.14, rand(4,12), front, "rgba(255,255,255,0.18)");

        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(cx - w*0.85, cy - h*0.05);
        ctx.quadraticCurveTo(cx, cy + h*0.25, cx + w*0.85, cy - h*0.05);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.08)";
        ctx.beginPath();
        ctx.ellipse(cx - w*0.18, cy - h*0.10, w*0.22, h*0.32, -0.35, 0, Math.PI*2);
        ctx.fill();
      }

      function drawTulip(x, y){
        if (!gateUnlocked) {
          showModal("Bloqueado üîí", "Los tulipanes se desbloquean a partir del d√≠a 15.");
          return;
        }

        const w = canvas.getBoundingClientRect().width;
        const h = canvas.getBoundingClientRect().height;

        const baseY = clamp2(y, h*0.40, h*0.95);
        const stemLen = rand(150, 270);
        const topY = clamp2(baseY - stemLen, 55, h*0.82);

        const sway = rand(-40, 40);
        const midX = x + sway*0.45;
        const topX = x + sway;

        ctx.lineCap = "round";
        ctx.strokeStyle = "rgba(70, 210, 135, 0.75)";
        ctx.lineWidth = rand(4.0, 5.2);
        ctx.beginPath();
        ctx.moveTo(x, baseY);
        ctx.quadraticCurveTo(midX, (baseY+topY)/2, topX, topY);
        ctx.stroke();

        ctx.strokeStyle = "rgba(120, 255, 190, 0.25)";
        ctx.lineWidth = 1.6;
        ctx.beginPath();
        ctx.moveTo(x-0.6, baseY);
        ctx.quadraticCurveTo(midX-0.6, (baseY+topY)/2, topX-0.6, topY);
        ctx.stroke();

        const leafFill = "rgba(60, 190, 110, 0.28)";
        const leafStroke = "rgba(110, 240, 160, 0.38)";
        const leaf1Y = baseY - rand(40, 110);
        const leaf2Y = baseY - rand(70, 150);

        drawLeaf(ctx, x + rand(-10, 12), leaf1Y, rand(120, 190), rand(18, 28), rand(-0.55, -0.15), leafFill, leafStroke);
        if (Math.random() > 0.25){
          drawLeaf(ctx, x + rand(-12, 10), leaf2Y, rand(110, 170), rand(18, 30), rand(0.15, 0.55), leafFill, leafStroke);
        }

        const bloomW = rand(34, 52);
        const bloomH = rand(44, 68);
        const hues = [350, 0, 12, 22, 48];
        const hue = hues[Math.floor(Math.random()*hues.length)];

        drawTulipBloom(ctx, topX, topY, bloomW, bloomH, hue);
      }

      function getPos(evt){
        const rect = canvas.getBoundingClientRect();
        const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
        const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }

      function plant(evt){
        evt.preventDefault();
        const p = getPos(evt);
        drawTulip(p.x, p.y);
      }

      canvas.addEventListener("pointerdown", plant);
      canvas.addEventListener("touchstart", plant, {passive:false});

      clearBtn?.addEventListener("click", () => drawBackground());
      saveBtn?.addEventListener("click", () => {
        const link = document.createElement("a");
        link.download = "tulipanes.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      })

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
    })();
  </script>
</body>
</html>


